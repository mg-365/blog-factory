<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>My Factory Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    /* #1 - ê¸°ë³¸ ìŠ¤íƒ€ì¼ (style íƒœê·¸ëŠ” ë‚˜ì¤‘ì— ê³„ì† í™•ì¥ ê°€ëŠ¥) */
    .input-bar {
      display: flex;
      gap: 10px;
      margin: 12px 0;
    }
    .url-input {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      flex: 1;
    }
    .add-btn {
      background-color: #00cc66;
      color: white;
      font-weight: bold;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- #2 - ëŒ€ì‹œë³´ë“œ UI ì „ì²´ ì˜¤ë²„ë ˆì´ -->
  <div class="overlay">
    <!-- #3 - ìš”ì•½ í†µê³„ ë°” -->
    <div class="summary-bar" id="summaryBar">
      ğŸ“Š ì „ì²´ ë¸”ë¡œê·¸ ìˆ˜: 0 | ì˜¤ëŠ˜ ì‘ì„±ëœ ê¸€: 0 | ë¯¸ì—´ëŒ ë¸”ë¡œê·¸: 0
    </div>

    <!-- #3.5 - ë¸”ë¡œê·¸ ì£¼ì†Œ ì…ë ¥ì°½ -->
    <div class="input-bar">
      <input class="url-input" type="text" id="newBlogUrl" placeholder="ìƒˆ ë¸”ë¡œê·¸ URL ì…ë ¥">
      <button class="add-btn" onclick="addBlogUrl()">â• ì¶”ê°€</button>
    </div>

    <!-- #4 - ì •ë ¬ ë²„íŠ¼ & ê²€ìƒ‰ì°½ -->
    <div class="sort-bar">
      <input class="search-input" type="text" id="searchInput" placeholder="ğŸ” ë¸”ë¡œê·¸ ê²€ìƒ‰" oninput="filterBlogs()">
      <button class="sort-btn" onclick="sortBlogs('created')">ğŸ•“ ìƒì„±ì¼ìˆœ</button>
      <button class="sort-btn" onclick="sortBlogs('visitors')">ğŸ”¥ ë°©ë¬¸ììˆœ</button>
      <button class="sort-btn" onclick="sortBlogs('status')">âš™ï¸ ìƒíƒœìˆœ</button>
    </div>

    <!-- #5 - ë¸”ë¡œê·¸ ì¹´ë“œë“¤ì´ ë Œë”ë§ë˜ëŠ” ë©”ì¸ ê³µê°„ -->
    <div class="dashboard" id="dashboard"></div>
  </div>

  <!-- #6 - ìë°”ìŠ¤í¬ë¦½íŠ¸ ì˜ì—­ ì‹œì‘ -->
  <script>
    let blogs = [];
    let filteredBlogs = [];

    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        blogs = data;
        filteredBlogs = [...blogs];
        renderCards();
      });

    function timeDiffText(isoTime) {
      const last = new Date(isoTime);
      const now = new Date();
      const diff = Math.floor((now - last) / (1000 * 60 * 60 * 24));
      return diff === 0 ? 'ì˜¤ëŠ˜ ì—´ëŒ' : `${diff}ì¼ ì „ ì—´ëŒ`;
    }

    function calcDaysPassed(dateStr) {
      const created = new Date(dateStr);
      const today = new Date();
      return Math.floor((today - created) / (1000 * 60 * 60 * 24));
    }

    function filterBlogs() {
      const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
      filteredBlogs = keyword ? blogs.filter(blog => blog.name.toLowerCase().includes(keyword)) : [...blogs];
      renderCards();
    }

    function renderCards() {
      const dashboard = document.getElementById('dashboard');
      dashboard.innerHTML = '';
      let todayCount = 0;
      let notReadCount = 0;

      filteredBlogs.forEach(blog => {
        if (blog.ì˜¤ëŠ˜ì‘ì„±) todayCount++;
        const notRead = new Date() - new Date(blog.ë§ˆì§€ë§‰ì—´ëŒ) > 1000 * 60 * 60 * 24 * 3;
        if (notRead) notReadCount++;

        const ìƒíƒœí´ë˜ìŠ¤ = blog.ìƒíƒœ === 'ìµœì í™”' ? 'highlight-green'
          : blog.ìƒíƒœ === 'ë¯¸ìµœì í™”' ? 'highlight-orange'
          : 'highlight-red';

        const card = document.createElement('div');
        card.className = 'blog-card';
        card.innerHTML = `
          <h2><img src="https://cdn-icons-png.flaticon.com/512/25/25231.png" alt="icon">${blog.name}</h2>
          <div class="mini-bar"><div class="mini-fill" style="width:${Math.min(blog.ë°©ë¬¸ì / 10, 100)}%"></div></div>
          <p>ì˜ˆì•½ ê¸€: <span class="highlight-blue">${blog.ì˜ˆì•½ê¸€}ê±´</span></p>
          <p>ì˜¤ëŠ˜ ë°©ë¬¸ì: <span class="highlight-green">${blog.ë°©ë¬¸ì}ëª…</span></p>
          <p>ìƒíƒœ: <span class="${ìƒíƒœí´ë˜ìŠ¤}">${blog.ìƒíƒœ}</span></p>
          <p>ê²Œì‹œê¸€: ${blog.ì‘ì„±ìˆ˜}ê°œ</p>
          <p>ì „ì²´ ê¸€: ${blog.ì „ì²´ê¸€}ê°œ</p>
          <p>ì´ˆì•ˆ ê¸€: ${blog.ì´ˆì•ˆ}ê°œ</p>
          <p>ìœ ì… í‚¤ì›Œë“œ: <span class="highlight-blue">${blog.í‚¤ì›Œë“œ}</span></p>
          <p>ìƒì„± í›„: <span class="highlight-purple">D+${calcDaysPassed(blog.ìƒì„±ì¼)}</span></p>
          <p>í¬ë¡¬ í”„ë¡œí•„: ${blog.í”„ë¡œí•„}</p>
          <p class="last-read">ğŸ•’ ${timeDiffText(blog.ë§ˆì§€ë§‰ì—´ëŒ)}${notRead ? ' <span class="alert">(ì—´ëŒ í•„ìš”!)</span>' : ''}</p>
          <button class="action-btn" onclick="console.log('âœ… ${blog.name} ì—´ê¸° í´ë¦­ë¨')">ğŸ” ì—´ê¸°</button>
        `;
        dashboard.appendChild(card);
      });

      document.getElementById('summaryBar').textContent = `ğŸ“Š ì „ì²´ ë¸”ë¡œê·¸ ìˆ˜: ${filteredBlogs.length} | ì˜¤ëŠ˜ ì‘ì„±ëœ ê¸€: ${todayCount} | ë¯¸ì—´ëŒ ë¸”ë¡œê·¸: ${notReadCount}`;
    }

    function sortBlogs(type) {
      if (type === 'created') {
        filteredBlogs.sort((a, b) => new Date(a.ìƒì„±ì¼) - new Date(b.ìƒì„±ì¼));
      } else if (type === 'visitors') {
        filteredBlogs.sort((a, b) => b.ë°©ë¬¸ì - a.ë°©ë¬¸ì);
      } else if (type === 'status') {
        const priority = { 'ìµœì í™”': 1, 'ë¯¸ìµœì í™”': 2, 'ì €í’ˆì§ˆ ì˜ì‹¬': 3 };
        filteredBlogs.sort((a, b) => priority[a.ìƒíƒœ] - priority[b.ìƒíƒœ]);
      }
      renderCards();
    }

    // #6-8: ë¸”ë¡œê·¸ URL ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ì²˜ë¦¬
    function addBlogUrl() {
      const input = document.getElementById('newBlogUrl');
      const url = input.value.trim();
      if (!url) return alert('ë¸”ë¡œê·¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

      console.log('ğŸ”— ìƒˆ ë¸”ë¡œê·¸ ì¶”ê°€ ìš”ì²­ë¨:', url);
      // TODO: ì„œë²„ë¡œ ì „ì†¡í•˜ê±°ë‚˜ ë¡œì»¬ ì €ì¥ ì—°ë™ í•„ìš” (Python ìë™í™”ì™€ ì—°ë™ ì˜ˆì •)
      input.value = '';
    }
  </script>
</body>
</html>
