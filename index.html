<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>My Factory Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: url('https://blog.kakaocdn.net/dn/bN0Ek5/btsH38aqAuD/h7t4HCL1BDPoacllLYu7ok/img.png') no-repeat center center fixed;
      background-size: cover;
      color: #f0f0f0;
    }
    .overlay {
      background-color: rgba(0, 0, 0, 0.7);
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
    }
    .summary-bar {
      font-size: 14px;
      color: #ccc;
      margin-bottom: 12px;
    }
    .input-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .url-input {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      flex: 1;
      font-size: 14px;
    }
    .add-btn {
      background-color: #00cc66;
      color: white;
      font-weight: bold;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    .sort-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .sort-btn {
      background-color: #00aaff;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    .search-input {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      width: 200px;
    }
    .dashboard {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      position: relative;
    }
    .blog-card {
      background-color: rgba(30, 30, 30, 0.9);
      border-radius: 12px;
      padding: 10px;
      width: 300px;
      box-shadow: 0 0 18px rgba(0, 255, 204, 0.4);
      transition: transform 0.2s ease-in-out, box-shadow 0.2s;
    }
    .blog-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 0 24px rgba(0, 255, 204, 0.8);
    }
    .blog-card h2 {
      margin-top: 0;
      font-size: 18px;
      color: #00ffc3;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .blog-card h2 img {
      width: 20px;
      height: 20px;
    }
    .mini-bar {
      height: 6px;
      background: #555;
      border-radius: 3px;
      margin: 2px 0 6px;
      overflow: hidden;
    }
    .mini-fill {
      height: 100%;
      background: linear-gradient(to right, #00ffcc, #00aaff);
    }
    .last-read {
      font-size: 11px;
      color: #aaa;
      margin-top: 2px;
    }
    .alert {
      color: #ff5555;
      font-weight: bold;
    }
    .action-btn {
      background-color: #00ffcc;
      color: #1b1b1b;
      border: none;
      padding: 6px 12px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 6px;
    }
    .highlight-green { color: #00ff99; font-weight: bold; }
    .highlight-blue { color: #66ccff; font-weight: bold; }
    .highlight-orange { color: #ffcc66; font-weight: bold; }
    .highlight-red { color: #ff6666; font-weight: bold; }
    .highlight-purple { color: #c28fff; font-weight: bold; }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="summary-bar" id="summaryBar">ğŸ“Š ì „ì²´ ë¸”ë¡œê·¸ ìˆ˜: 0 | ì˜¤ëŠ˜ ì‘ì„±ëœ ê¸€: 0 | ë¯¸ì—´ëŒ_ë¸”ë¡œê·¸: 0</div>

    <div class="input-bar">
      <input class="url-input" type="text" id="newBlogUrl" placeholder="ìƒˆ ë¸”ë¡œê·¸ URL ì…ë ¥">
      <button class="add-btn" onclick="addBlogUrl()">â• ì¶”ê°€</button>
    </div>

    <div class="sort-bar">
      <input class="search-input" type="text" id="searchInput" placeholder="ğŸ” ë¸”ë¡œê·¸ ê²€ìƒ‰" oninput="filterBlogs()">
      <button class="sort-btn" onclick="sortBlogs('created')">ğŸ•“ ìƒì„±ì¼ìˆœ</button>
      <button class="sort-btn" onclick="sortBlogs('visitors')">ğŸ”¥ ë°©ë¬¸ììˆœ</button>
      <button class="sort-btn" onclick="sortBlogs('status')">âš™ï¸ ìƒíƒœìˆœ</button>
    </div>

    <div class="dashboard" id="dashboard"></div>
  </div>

  <script>
    let blogs = [];
    let filteredBlogs = [];

    fetch('https://blog-factory-engine.onrender.com/data')
      .then(res => res.json())
      .then(data => {
        blogs = data;
        filteredBlogs = [...blogs];
        renderCards();
      });

    function timeDiffText(isoTime) {
      const last = new Date(isoTime);
      const now = new Date();
      const diff = Math.floor((now - last) / (1000 * 60 * 60 * 24));
      return diff === 0 ? 'ì˜¤ëŠ˜ ì—´ëŒ' : `${diff}ì¼ ì „ ì—´ëŒ`;
    }

    function calcDaysPassed(dateStr) {
      const created = new Date(dateStr);
      const today = new Date();
      return Math.floor((today - created) / (1000 * 60 * 60 * 24));
    }

    function filterBlogs() {
      const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
      filteredBlogs = keyword ? blogs.filter(blog => blog.name.toLowerCase().includes(keyword)) : [...blogs];
      renderCards();
    }

    function renderCards() {
      const dashboard = document.getElementById('dashboard');
      dashboard.innerHTML = '';
      let todayCount = 0;
      let notReadCount = 0;


      filteredBlogs.forEach(blog => {
        if (blog.ì˜¤ëŠ˜ì‘ì„±) todayCount++;
        const notRead = new Date() - new Date(blog.ë§ˆì§€ë§‰ì—´ëŒ) > 1000 * 60 * 60 * 24 * 3;
        if (notRead) notReadCount++;

        const ìƒíƒœí´ë˜ìŠ¤ = blog.ìƒíƒœ === 'ìµœì í™”' ? 'highlight-green'
          : blog.ìƒíƒœ === 'ë¯¸ìµœì í™”' ? 'highlight-orange'
          : 'highlight-red';

        // âœ… ë‹¤ìŒ ì €í’ˆì§ˆ ì§„ë‹¨ ê²°ê³¼ ë³€ìˆ˜ ì¶”ê°€
        const ê¸€ìˆ˜ = blog.ê¸€ìˆ˜ì§„ë‹¨ ?? 0;
        const ì‚¬ì´íŠ¸ = blog.ì‚¬ì´íŠ¸ë…¸ì¶œ ? 'O' : 'X';
        const ê²€ìƒ‰ë§í¬ = blog.ê²€ìƒ‰ë§í¬ ?? '#';
        
        const card = document.createElement('div');
        card.className = 'blog-card';
        card.innerHTML = `
          <h2><img src="https://cdn-icons-png.flaticon.com/512/25/25231.png" alt="icon">${blog.name}</h2>
          <div class="mini-bar"><div class="mini-fill" style="width:${Math.min(blog.ë°©ë¬¸ì / 10, 100)}%"></div></div>
          
          <!-- âœ… ì§„ë‹¨ ì •ë³´ í‘œì‹œ ì¶”ê°€ -->
          <p>í†µí•©ê²€ìƒ‰: 
            ê¸€ <a href="${ê²€ìƒ‰ë§í¬}" target="_blank">${ê¸€ìˆ˜}</a> / 
            ì‚¬ì´íŠ¸ <a href="${ê²€ìƒ‰ë§í¬}" target="_blank">${ì‚¬ì´íŠ¸}</a>
          </p>
          
          <p>ì˜ˆì•½ ê¸€: <span class="highlight-blue">${blog.ì˜ˆì•½ê¸€}ê±´</span></p>
          <p>ì˜¤ëŠ˜ ë°©ë¬¸ì: <span class="highlight-green">${blog.ë°©ë¬¸ì}ëª…</span></p>
          <p>ìƒíƒœ: <span class="${ìƒíƒœí´ë˜ìŠ¤}">${blog.ìƒíƒœ}</span></p>
          <p>ê²Œì‹œê¸€: ${blog.ì‘ì„±ìˆ˜}ê°œ</p>
          <p>ì „ì²´ ê¸€: ${blog.ì „ì²´ê¸€}ê°œ</p>
          <p>ì´ˆì•ˆ ê¸€: ${blog.ì´ˆì•ˆ}ê°œ</p>
          <p>ìœ ì… í‚¤ì›Œë“œ: <span class="highlight-blue">${blog.í‚¤ì›Œë“œ}</span></p>
          <p>ìƒì„± í›„: <span class="highlight-purple">D+${calcDaysPassed(blog.ìƒì„±ì¼)}</span></p>
          <p>í¬ë¡¬ í”„ë¡œí•„: ${blog.í”„ë¡œí•„}</p>
          <p class="last-read">ğŸ•’ ${timeDiffText(blog.ë§ˆì§€ë§‰ì—´ëŒ)}${notRead ? ' <span class="alert">(ì—´ëŒ í•„ìš”!)</span>' : ''}</p>
          <button class="action-btn" onclick="console.log('âœ… ${blog.name} ì—´ê¸° í´ë¦­ë¨')">ğŸ” ì—´ê¸°</button>
          <button class="delete-btn" data-id="${blog.id}">ì‚­ì œ</button>
        `;
        dashboard.appendChild(card);
      });

     
      document.getElementById('summaryBar').textContent = `ğŸ“Š ì „ì²´ ë¸”ë¡œê·¸ ìˆ˜: ${filteredBlogs.length} | ì˜¤ëŠ˜ ì‘ì„±ëœ ê¸€: ${todayCount} | ë¯¸ì—´ëŒ ë¸”ë¡œê·¸: ${notReadCount}`;
    }

    function sortBlogs(type) {
      if (type === 'created') {
        filteredBlogs.sort((a, b) => new Date(a.ìƒì„±ì¼) - new Date(b.ìƒì„±ì¼));
      } else if (type === 'visitors') {
        filteredBlogs.sort((a, b) => b.ë°©ë¬¸ì - a.ë°©ë¬¸ì);
      } else if (type === 'status') {
        const priority = { 'ìµœì í™”': 1, 'ë¯¸ìµœì í™”': 2, 'ì €í’ˆì§ˆ ì˜ì‹¬': 3 };
        filteredBlogs.sort((a, b) => priority[a.ìƒíƒœ] - priority[b.ìƒíƒœ]);
      }
      renderCards();
    }

    function addBlogUrl() {
  const input = document.getElementById('newBlogUrl');
  const url = input.value.trim();
  if (!url) return alert('ë¸”ë¡œê·¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

  const blogData = {
    name: url,
    ìƒíƒœ: "ë¯¸ìµœì í™”",
    ì˜ˆì•½ê¸€: 0,
    ì‘ì„±ìˆ˜: 0,
    ì „ì²´ê¸€: 0,
    ì´ˆì•ˆ: 0,
    í‚¤ì›Œë“œ: "ë¯¸ì…ë ¥",
    ìƒì„±ì¼: new Date().toISOString().slice(0, 10),
    ì˜¤ëŠ˜ì‘ì„±: false,
    ë§ˆì§€ë§‰ì—´ëŒ: new Date().toISOString(),
    í”„ë¡œí•„: "Profile X",
    ë°©ë¬¸ì: 0
  };

  fetch("https://blog-factory-engine.onrender.com/add", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(blogData)
  })
  .then(res => res.json())
  .then(res => {
    if (res.message === 'Blog added!') {
      alert("ë¸”ë¡œê·¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
      input.value = "";
      location.reload(); // ìƒˆë¡œê³ ì¹¨
    } else {
      alert("ì˜¤ë¥˜ ë°œìƒ: " + JSON.stringify(res));
    }
  })
  .catch(err => {
    alert("ì„œë²„ ì˜¤ë¥˜: " + err.message);
  });
}


     // ğŸ”½ 2. ì¹´ë“œë“¤ì´ ë‹¤ ìƒì„±ëœ ì´í›„ì— ì´ ì½”ë“œê°€ ì‹¤í–‰ë¼ì•¼ í•¨
      document.addEventListener("click", async (e) => {
        if (e.target.classList.contains("delete-btn")) {
          const id = e.target.dataset.id;
      
          const res = await fetch("https://blog-factory-engine.onrender.com/delete", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: parseInt(id) })
          });
      
          if (res.ok) {
            alert("ì‚­ì œ ì„±ê³µ!");
            location.reload(); // ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì¹´ë“œ ê°±ì‹ 
          } else {
            alert("ì‚­ì œ ì‹¤íŒ¨!");
          }
        }
      });

    
  </script>
</body>
</html>
